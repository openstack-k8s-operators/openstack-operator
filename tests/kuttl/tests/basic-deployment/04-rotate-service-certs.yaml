apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - script: |
      echo "Waiting for OpenStack control plane to be ready..."
      oc wait openstackcontrolplane -n $NAMESPACE --for=condition=Ready --timeout=400s -l core.openstack.org/openstackcontrolplane

  - script: |
      echo "Get fingerprints of all service certs"
      oc exec -i openstackclient -n $NAMESPACE -- bash -s < ../../common/osp_endpoint_finger_prints.sh > /tmp/endpoint_fingerprints_before
      
  - script: |
      echo "Deleting secrets..."
      oc get secret -l service-cert -n $NAMESPACE -o name > /tmp/deleted-secrets.txt
      oc delete secret -l service-cert -n $NAMESPACE 
